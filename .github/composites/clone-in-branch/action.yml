name: "Checkout to branch if exists"
description: "Clones the specified repository in the provided branches if exist"

inputs:
  repo_url:
    description: "Url to the repository to clone"
    required: true
  prioritized_branches:
    description: "List of branches to try to checkout in priority order"
    required: true
  path:
    description: "Path to download the repository into"
    required: false
    default: ${{ github.workspace }}
  target_name:
    description: "Target name for the repository to clone"
    required: false
  verbose:
    description: "If set to true, show trace of the execution steps"
    required: false
    default: false

runs:
  using: "composite"
  steps:
    - name: Get repo url
      shell: bash
      run: |
        echo "REPO_URL=${{ inputs.repo_url }}" >> $GITHUB_ENV
        if [[ ${{ inputs.verbose }} == 'true' ]] ; then
          echo "Received git url: ${{ inputs.repo_url }}"
        fi
    
    - name: Get repo name
      shell: bash
      run: |
        if [ -n "${{ inputs.target_name }}" ]; then
          export REPO_NAME=${{ inputs.target_name }}
        else
          export REPO_NAME=$(basename -s .git $REPO_URL)
        fi
        echo "REPO_NAME=$REPO_NAME" >> $GITHUB_ENV
        if [[ ${{ inputs.verbose }} == 'true' ]] ; then
          echo "Target repository name: $REPO_NAME"
        fi

    - name: Clone repository
      shell: bash
      working-directory: ${{ inputs.path }}
      run: |
        if [ -n "${{ inputs.target_name }}" ]; then
          if [[ ${{ inputs.verbose }} == 'true' ]] ; then
            echo "Cloning with path: ${{ inputs.path }}/${{ inputs.target_name }}"
          fi
          git clone $REPO_URL ${{ inputs.target_name }}
        else
          if [[ ${{ inputs.verbose }} == 'true' ]] ; then
            echo "Cloning with path: ${{ inputs.path }}/"
          fi
          git clone $REPO_URL
        fi
        $(basename -s .git "$repo_url")
